# 多线程中的信号与槽
- 令人不解的问题
    当槽函数是线程类中的成员时，为什么依然不在本线程内被调用执行？

- 隐藏的问题
    - 对象依附于哪一个线程？
    - 对象的依附性与槽函数执行的关系？
    - 对象的依附性是否可以改变？

- 对象依附于哪一个线程？
    默认情况下，对象依附于自身被创建的线程；例如：对象在主线程（main()函数）中被创建，则依附于主线程。
    ```c
    int main(int argc, char *argv[])
    {
        // ...
        TestThread t; /* 依附于主线程 */
        MyObject m;   /* 依附于主线程 */
        // ...
    }
    ```

- 对象的依附性与槽函数执行的关系？
    默认情况下，槽函数在其所依附的线程中被调用执行！
    ```c
    int main(int argc, char *argv[])
    {
        // ...
        TestThread t; /* 依附于主线程 */
        MyObject m;   /* 依附于主线程 */

        /* 下面连接中的槽函数都在主线程被调用执行 */
        QObject::connect(&t, SIGNAL(started()), &m, SLOT(getStarted()));
        QObject::connect(&t, SIGNAL(testSignal()), &m, SLOT(testSlot()));

        // ...
    }
    ```

- 对象的依附性是否可以改变？
    QObject::moveToThread 用于改变对象的线程依附性，使得对象的槽函数在依附的线程中被调用执行。
    ```c
    int main(int argc, char *argv[])
    {
        // ...
        TestThread t; /* 依附于主线程 */
        MyObject m;   /*依附于主线程 */

        /* 改变对象m的缴呈依附性，使其依附与线程t */
        m.moveToThread(&t);

        // ...
    }
    ```

# 编程实验 对象的依附性

- 问题
    实验中对象m的槽函数为什么没有被调用执行？

- 线程中的事件循环
    - 信号与槽的机制需要事件循环的支持
    - QThread 类中提供的 exec() 函数用于开启线程的事件循环
    - 只有事件循环开启，槽函数才能在信号发送后被调用

- 线程的事件循环
    ![](_v_images_/.png)

- 小结论
    - 前提条件
        - 对象依附的线程开启了事件循环
    - 后置结果
        - 对象中的槽函数在依附的线程中被调用执行

# 编程实验 线程的事街I环

- 硏究槽函数的具体执行线程有什么意义？
    当信号的发送与对应槽函数的执行在不同线程中时，可能产生临界资源的竞争问题！

# 小结
- 默认情况下，对象依附于自身被创建的线程
- QObject::moveToThread 用于改变对象的线程依附注
- 信号与槽的机制需要事件循环的支持
- exec() 函数用于开启线程的事件循环
- 对象中的槽函数在依附的线程中被调用执行
