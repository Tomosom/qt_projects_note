# 打造网络聊天程序（中)
- 在主窗口类中使用客户端类
    ![](_v_images_/.png)

- 初步设计方案
    - 主窗口中通过 ClientDemo 进行消息发送
    - 主窗口通过 TxtMsgHandler 接口收取消息
    - 网络消息通过 TextMessage 进行传递（ TextMessage::data() )
    - 最终，将网络消息显示在文本控件中

- 连接服务端流程
    ![](_v_images_/.png)

- 两个关键的操作
    - 连接成功
        - 当服务端连接成功，需要改变界面组件的状态（收发消息状态)
    - 断开连接
        - 当与服务端的连接断开，恢复界面状态为初始态（未登录状态)

- 定义关键操作对应的消息
    - TextMessage conn( "CONN", "IP:PORT");
        - 连接成功后通过 handle 接口传递
        - 数据域为通信远端的IP地址和端口
    - TextMessage dscn( "DSCN", "");
        - 与服务端连接断开后通过 handle 接口传递

# 编程实验 聊天客户端初步开发

- 服务端设计初步
    ![](_v_images_/.png)

- 设计要素分析
    - 一般情况下，聊天服务端只负责消息传递
    - 客户端的连接与断开是两个关键操作，必须消息通知
    - 服务端能够随时对指定客户端发送消息

- 设计要素分析
    - 如何设计使得服务端能够随时对指定客户端发送消息？？
        - 客户端的连接（QTcpSokcet对象）有唯一标识符（ID)
        - 可以通过 ID 查找对应的 QTcpSocket 对象，进而发送消息

    ![](_v_images_/.png)

# 编程实验 聊天服务端初步开发


# 实战预告
- To be continued ...
    思考：
    如何设计客户端和服务端之间的消息交互流程?
